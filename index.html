<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>å¤œå–°ã‚‰ã„ã®è¿·å®®</title>

<style>
body{
  margin:0;
  background:radial-gradient(#000,#020202);
  color:#eee;
  font-family:sans-serif;
  text-align:center;
}

h1,h2{letter-spacing:3px}

#top,#game,#gacha,#zukan{display:none}

button{
  background:#111;
  color:#fff;
  border:1px solid #444;
  padding:10px 20px;
  margin:6px;
  border-radius:6px;
  font-size:16px;
}
button:hover{background:#222}

#map{
  display:grid;
  grid-template-columns:repeat(9,36px);
  gap:2px;
  justify-content:center;
  margin:10px auto;
}

.cell{width:36px;height:36px;background:#000}
.wall{background:#111}
.player{background:#09f;box-shadow:0 0 10px #09f}
.enemy{background:#c00;box-shadow:0 0 10px #f00}
.stairs{background:#0a0;box-shadow:0 0 10px #0f0}
.pet{background:#ff0;box-shadow:0 0 10px #ff0}

.night .cell{filter:brightness(.25)}
.night .player,.night .enemy,.night .stairs,.night .pet{filter:brightness(1)}

#ui{margin:6px}

/* ===== GACHA ===== */
#gachaBox{
  font-size:80px;
  margin:10px;
}
.ssr{
  color:#ffd700;
  text-shadow:0 0 20px gold;
  animation:flash 0.3s infinite alternate;
}
@keyframes flash{
  from{transform:scale(1)}
  to{transform:scale(1.1)}
}

/* ===== å›³é‘‘ ===== */
.zukan-item{
  border:1px solid #333;
  margin:8px;
  padding:8px;
  border-radius:6px;
  background:#080808;
}
</style>
</head>

<body>

<!-- ===== TITLE ===== -->
<div id="top">
  <h1>ğŸŒ™ å¤œå–°ã‚‰ã„ã®è¿·å®®</h1>
  <p style="opacity:.7">é—‡ã«å–°ã‚ã‚Œã‚‹å‰ã«é€²ã‚</p>
  <button onclick="start()">â–¶ ã¯ã˜ã‚ã‚‹</button>
  <button onclick="openGacha()">ğŸ° ã‚¬ãƒãƒ£</button>
  <button onclick="openZukan()">ğŸ“– å›³é‘‘</button>
</div>

<!-- ===== GAME ===== -->
<div id="game">
  <div id="ui"></div>
  <div id="map"></div>
  <div>
    <button onclick="move(0,-1)">â¬†</button><br>
    <button onclick="move(-1,0)">â¬…</button>
    <button onclick="move(1,0)">â¡</button><br>
    <button onclick="move(0,1)">â¬‡</button>
  </div>
</div>

<!-- ===== GACHA ===== -->
<div id="gacha">
  <h2>ğŸ° é—‡ã®ã‚¬ãƒãƒ£</h2>
  <div id="gachaBox">ğŸ’</div>
  <p id="gachaResult"></p>
  <button onclick="roll()">å›ã™ï¼ˆç„¡æ–™ï¼‰</button>
  <button onclick="backTitle()">æˆ»ã‚‹</button>
</div>

<!-- ===== ZUKAN ===== -->
<div id="zukan">
  <h2>ğŸ“– ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼å›³é‘‘</h2>
  <div id="zukanList"></div>
  <button onclick="backTitle()">æˆ»ã‚‹</button>
</div>

<script>
const size=9;
let map=[],px,py,floor,hp,food;
let enemies=[],pet;
let discovered={};

const monsters={
  slime:{name:"é—‡ã‚¹ãƒ©ã‚¤ãƒ ",atk:2,desc:"å¤œã«æº¶ã‘ã‚‹æœ€å¼±ã®é­”ç‰©"},
  wolf:{name:"å¤œç‰™ã®ç‹¼",atk:4,desc:"é™ã‹ã«è¿‘ã¥ãç‹©äºº"}
};

function gen(){
  map=[];
  for(let y=0;y<size;y++){
    let r=[];
    for(let x=0;x<size;x++)
      r.push(Math.random()<0.15?"#":".");
    map.push(r);
  }
  px=1;py=1;
  map[7][7]=">";
  enemies=[
    {x:5,y:5,type:"slime"},
    {x:6,y:2,type:"wolf"}
  ];
  pet={x:px+1,y:py};
}

function draw(){
  document.body.className=floor>=5?"night":"";
  mapDiv.innerHTML="";
  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      let c="cell";
      if(map[y][x]==="#")c+=" wall";
      if(px===x&&py===y)c+=" player";
      if(map[y][x]===">")c+=" stairs";
      enemies.forEach(e=>{if(e.x===x&&e.y===y)c+=" enemy";});
      if(pet.x===x&&pet.y===y)c+=" pet";
      mapDiv.innerHTML+=`<div class="${c}"></div>`;
    }
  }
  ui.textContent=`${floor}F â¤ï¸${hp} ğŸ–${food}`;
}

function move(dx,dy){
  let nx=px+dx,ny=py+dy;
  if(map[ny][nx]==="#")return;
  px=nx;py=ny;
  pet.x+=Math.sign(px-pet.x);
  pet.y+=Math.sign(py-pet.y);
  food--;

  enemies.forEach(e=>{
    if(Math.abs(px-e.x)+Math.abs(py-e.y)<=1){
      hp-=monsters[e.type].atk;
      discovered[e.type]=true;
    }
  });

  if(map[py][px]===">"){floor++;gen();}
  if(hp<=0||food<=0){alert("ğŸ’€");location.reload();}
  draw();
}

function start(){
  top.style.display="none";
  game.style.display="block";
  floor=1;hp=20;food=20;
  gen();draw();
}

/* ===== GACHA ===== */
function openGacha(){
  top.style.display="none";
  gacha.style.display="block";
}
function roll(){
  gachaBox.className="";
  const r=Math.random();
  if(r<0.1){
    gachaBox.textContent="ğŸŒŸ";
    gachaBox.classList.add("ssr");
    gachaResult.textContent="SSRï¼å¤œå–°ã‚‰ã„ã®åŠ è­·ï¼ˆHP+10ï¼‰";
    hp+=10;
  }else{
    gachaBox.textContent="ğŸ’ ";
    gachaResult.textContent="Rï¼šé£Ÿæ–™+5";
    food+=5;
  }
}

/* ===== ZUKAN ===== */
function openZukan(){
  top.style.display="none";
  zukan.style.display="block";
  zukanList.innerHTML="";
  for(let k in monsters){
    if(discovered[k]){
      zukanList.innerHTML+=
        `<div class="zukan-item">
          <b>${monsters[k].name}</b><br>
          æ”»æ’ƒ:${monsters[k].atk}<br>
          ${monsters[k].desc}
        </div>`;
    }
  }
  if(zukanList.innerHTML==="")
    zukanList.innerHTML="<p>ã¾ã ç™ºè¦‹ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>";
}

function backTitle(){
  game.style.display="none";
  gacha.style.display="none";
  zukan.style.display="none";
  top.style.display="block";
}

top.style.display="block";
</script>

</body>
</html>
