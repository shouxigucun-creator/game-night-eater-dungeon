<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>å¤œå–°ã‚‰ã„ã®è¿·å®®</title>

<style>
body{
  margin:0;
  background:#000;
  color:#eee;
  font-family:sans-serif;
  text-align:center;
}

button{
  background:#111;
  color:#fff;
  border:1px solid #444;
  padding:10px 18px;
  margin:6px;
  border-radius:6px;
  font-size:16px;
}

#top,#game,#gacha,#zukan{display:none}

#map{
  display:grid;
  grid-template-columns:repeat(9,32px);
  justify-content:center;
  margin:10px auto;
}

.cell{width:32px;height:32px;border:1px solid #222}
.wall{background:#111}
.player{background:#09f}
.enemy{background:#c00}
.stairs{background:#0a0}

.night .cell{filter:brightness(.35)}
.night .player,.night .enemy,.night .stairs{filter:brightness(1)}

.ssr{
  color:gold;
  text-shadow:0 0 12px gold;
  font-weight:bold;
}

.zukan-item{
  border:1px solid #333;
  margin:6px;
  padding:6px;
}
</style>
</head>

<body>

<div id="top">
  <h1>ğŸŒ™ å¤œå–°ã‚‰ã„ã®è¿·å®®</h1>
  <button id="btnStart">â–¶ å†’é™ºé–‹å§‹</button>
  <button id="btnGacha">ğŸ° ã‚¬ãƒãƒ£</button>
  <button id="btnZukan">ğŸ“– å›³é‘‘</button>
</div>

<div id="game">
  <div id="ui"></div>
  <div id="map"></div>
  <div>
    <button onclick="move(0,-1)">â¬†</button><br>
    <button onclick="move(-1,0)">â¬…</button>
    <button onclick="move(1,0)">â¡</button><br>
    <button onclick="move(0,1)">â¬‡</button>
  </div>
</div>

<div id="gacha">
  <h2>ğŸ° é—‡ã®ã‚¬ãƒãƒ£</h2>
  <p id="gachaResult"></p>
  <button id="btnRoll">å›ã™</button><br>
  <button onclick="backToTop()">æˆ»ã‚‹</button>
</div>

<div id="zukan">
  <h2>ğŸ“– ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼å›³é‘‘</h2>
  <div id="zukanList"></div>
  <button onclick="backToTop()">æˆ»ã‚‹</button>
</div>

<script>
/* ===== DOMå®Œå…¨èª­è¾¼å¾Œã«é–‹å§‹ ===== */
window.addEventListener("DOMContentLoaded",()=>{

  const top = document.getElementById("top");
  const game = document.getElementById("game");
  const gacha = document.getElementById("gacha");
  const zukan = document.getElementById("zukan");
  const mapDiv = document.getElementById("map");
  const ui = document.getElementById("ui");
  const gachaResult = document.getElementById("gachaResult");
  const zukanList = document.getElementById("zukanList");

  const size = 9;
  let map=[],px,py,floor,hp,food,enemies=[];
  let discovered={};

  const monsters={
    slime:{name:"é—‡ã‚¹ãƒ©ã‚¤ãƒ ",atk:2},
    wolf:{name:"å¤œç‹¼",atk:4}
  };

  function gen(){
    map=[];
    for(let y=0;y<size;y++){
      let r=[];
      for(let x=0;x<size;x++){
        r.push(Math.random()<0.15?"#":".");
      }
      map.push(r);
    }
    px=1;py=1;
    map[7][7]=">";
    enemies=[
      {x:4,y:4,type:"slime"},
      {x:6,y:2,type:"wolf"}
    ];
  }

  function draw(){
    document.body.className = floor>=5 ? "night" : "";
    mapDiv.innerHTML="";
    for(let y=0;y<size;y++){
      for(let x=0;x<size;x++){
        let c="cell";
        if(map[y][x]==="#")c+=" wall";
        if(px===x&&py===y)c+=" player";
        if(map[y][x]===">")c+=" stairs";
        enemies.forEach(e=>{
          if(e.x===x&&e.y===y)c+=" enemy";
        });
        mapDiv.innerHTML+=`<div class="${c}"></div>`;
      }
    }
    ui.textContent = `${floor}F â¤ï¸${hp} ğŸ–${food}`;
  }

  window.move = function(dx,dy){
    let nx=px+dx, ny=py+dy;
    if(map[ny][nx]==="#")return;
    px=nx; py=ny;
    food--;

    enemies.forEach(e=>{
      if(Math.abs(px-e.x)+Math.abs(py-e.y)<=1){
        hp -= monsters[e.type].atk;
        discovered[e.type]=true;
      }
    });

    if(map[py][px]===">"){
      floor++;
      gen();
    }

    if(hp<=0||food<=0){
      alert("ğŸ’€ ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼");
      location.reload();
    }
    draw();
  };

  function start(){
    top.style.display="none";
    game.style.display="block";
    floor=1;hp=20;food=20;
    gen();draw();
  }

  function openGacha(){
    top.style.display="none";
    gacha.style.display="block";
    gachaResult.textContent="";
  }

  function roll(){
    if(Math.random()<0.1){
      gachaResult.innerHTML="<span class='ssr'>SSRï¼HP+10</span>";
      hp+=10;
    }else{
      gachaResult.textContent="Rï¼šé£Ÿæ–™+5";
      food+=5;
    }
  }

  function openZukan(){
    top.style.display="none";
    zukan.style.display="block";
    zukanList.innerHTML="";
    for(let k in monsters){
      if(discovered[k]){
        zukanList.innerHTML+=
          `<div class="zukan-item">${monsters[k].name}</div>`;
      }
    }
    if(!zukanList.innerHTML){
      zukanList.innerHTML="<p>æœªç™ºè¦‹</p>";
    }
  }

  window.backToTop = function(){
    game.style.display="none";
    gacha.style.display="none";
    zukan.style.display="none";
    top.style.display="block";
  };

  document.getElementById("btnStart").onclick=start;
  document.getElementById("btnGacha").onclick=openGacha;
  document.getElementById("btnZukan").onclick=openZukan;
  document.getElementById("btnRoll").onclick=roll;

  top.style.display="block";
});
</script>

</body>
</html>
